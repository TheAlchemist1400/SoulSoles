{% extends 'store/base.html' %}
{% load static %}
{% block content %}

<div class="container my-4">

  <!-- Sneaker Name -->
  <h1 class="mb-3">{{ sneaker.name }}</h1>

  <!-- Image row: main image + extra images -->
  <div class="row mb-3">
    <!-- Main Image -->
    <div class="col-12 col-md-6 mb-3">
      <img src="{{ sneaker.image.url }}" 
           alt="{{ sneaker.name }}" 
           class="img-fluid rounded" 
           style="max-height: 350px; object-fit: cover;">
    </div>

    <!-- Extra Images -->
    {% for img in images %}
      <div class="col-6 col-md-3 mb-3">
        <img src="{{ img.image.url }}" 
             alt="Extra image" 
             class="img-fluid rounded" 
             style="max-height: 200px; object-fit: cover;">
      </div>
    {% endfor %}
  </div>

  <!-- Sneaker Descriptions -->
  <p class="fw-bold">{{ sneaker.short_description }}</p>
  <p style="max-width: 100%;">{{ sneaker.description }}</p>

  <!-- Dynamic Price Area -->
  <div id="price-display" class="mb-3 fw-bold" style="font-size: 1.2rem;">
    {% if first_available_size %}
      {% if first_available_size.original_price and first_available_size.price < first_available_size.original_price %}
        <span id="sale-price" class="text-danger">R {{ first_available_size.price }}</span>
        <span id="original-price" class="text-muted text-decoration-line-through ms-2">R {{ first_available_size.original_price }}</span>
        <span class="text-success ms-2">On Sale</span>
      {% else %}
        <span id="sale-price">R {{ first_available_size.price }}</span>
      {% endif %}
    {% endif %}
  </div>

  <!-- Size Selection Form -->
  {% if has_available_size %}
    <form method="post" action="{% url 'add_to_cart' first_available_size.id %}" class="mb-4">
      {% csrf_token %}
      <div class="d-flex flex-column flex-sm-row align-items-start align-items-sm-center gap-2">
        <label for="size" class="mb-1 mb-sm-0">Select Size:</label>
        <select name="size" id="size" class="form-select w-auto" onchange="handleSizeChange(this)">
          {% for size in available_sizes %}
            <option value="{{ size.id }}" data-price="{{ size.price }}" data-original="{{ size.original_price }}">{{ size.size }} â€” R {{ size.price }}</option>
          {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary">Add to Cart</button>
      </div>
    </form>
  {% else %}
    <p class="text-danger fw-bold">Sold Out</p>
  {% endif %}

</div>

<script>
function handleSizeChange(select) {
  const selected = select.options[select.selectedIndex];
  const price = selected.getAttribute('data-price');
  const original = selected.getAttribute('data-original');
  const priceDisplay = document.getElementById('price-display');
  const form = select.closest('form');
  form.action = '/add-to-cart/' + selected.value + '/';

  if (original && parseFloat(original) > parseFloat(price)) {
    priceDisplay.innerHTML = `
      <span id="sale-price" class="text-danger">R ${price}</span>
      <span id="original-price" class="text-muted text-decoration-line-through ms-2">R ${original}</span>
      <span class="text-success ms-2">On Sale</span>
    `;
  } else {
    priceDisplay.innerHTML = `<span id="sale-price">R ${price}</span>`;
  }
}

window.onload = updatePrice;

function updatePrice() {
  const select = document.getElementById('size');
  if (select) handleSizeChange(select);
}
</script>

{% endblock %}
